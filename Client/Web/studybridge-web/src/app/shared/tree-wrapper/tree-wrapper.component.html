<div class="tree-wrapper-container">
  <!-- Header Section with Counts -->
  <div *ngIf="config.showHeader" class="tree-header mb-4 p-4 bg-gray-50 rounded-lg border">
    <div class="flex justify-between items-center mb-3">
      <h3 class="text-lg font-semibold text-gray-800">
        📊 {{ config.headerTitle }}
      </h3>
      <div class="flex space-x-2">
        <button 
          class="px-3 py-1 text-xs bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors"
          (click)="expandAll()" 
          title="Expand All">
          ⬇️ Expand All
        </button>
        <button 
          class="px-3 py-1 text-xs bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors"
          (click)="collapseAll()" 
          title="Collapse All">
          ⬆️ Collapse All
        </button>
      </div>
    </div>

    <!-- Top Level Counts -->
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-3">
      <div class="flex items-center space-x-2 bg-white p-3 rounded border">
        <span class="text-blue-500 text-lg">📁</span>
        <div>
          <div class="text-sm font-medium text-gray-600">Total Items</div>
          <div class="text-xl font-bold text-gray-900">{{ counts.totalNodes }}</div>
        </div>
      </div>
      
      <div class="flex items-center space-x-2 bg-white p-3 rounded border">
        <span class="text-green-500 text-lg">✅</span>
        <div>
          <div class="text-sm font-medium text-gray-600">Selected</div>
          <div class="text-xl font-bold text-green-600">{{ counts.selectedNodes }}</div>
        </div>
      </div>
      
      <div class="flex items-center space-x-2 bg-white p-3 rounded border">
        <span class="text-purple-500 text-lg">🗂️</span>
        <div>
          <div class="text-sm font-medium text-gray-600">Categories</div>
          <div class="text-xl font-bold text-gray-900">{{ counts.parentNodes }}</div>
        </div>
      </div>
      
      <div class="flex items-center space-x-2 bg-white p-3 rounded border">
        <span class="text-orange-500 text-lg">📄</span>
        <div>
          <div class="text-sm font-medium text-gray-600">Items</div>
          <div class="text-xl font-bold text-gray-900">{{ counts.leafNodes }}</div>
        </div>
      </div>
    </div>

    <!-- Selection Actions -->
    <div class="flex justify-between items-center">
      <div class="text-sm text-gray-600">
        <span class="font-medium">Selection:</span> 
        {{ counts.selectedNodes }} of {{ counts.totalNodes }} items selected
        <span *ngIf="counts.selectedNodes > 0" class="text-green-600">
          ({{ ((counts.selectedNodes / counts.totalNodes) * 100) | number:'1.0-1' }}%)
        </span>
      </div>
      
      <div class="flex space-x-2">
        <button 
          class="px-3 py-1 text-xs bg-green-500 text-white rounded hover:bg-green-600 transition-colors"
          (click)="selectAll()" 
          title="Select All">
          ✅ Select All
        </button>
        <button 
          class="px-3 py-1 text-xs bg-red-500 text-white rounded hover:bg-red-600 transition-colors"
          (click)="clearSelection()" 
          [disabled]="counts.selectedNodes === 0"
          title="Clear Selection">
          ❌ Clear All
        </button>
      </div>
    </div>
  </div>

  <!-- Tree Component -->
  <div class="tree-content border rounded-lg p-4 bg-white">
    <p-tree 
      [value]="processedTreeData"
      [selectionMode]="config.selectionMode || 'checkbox'"
      [class]="config.cssClass || 'w-full'"
      [(selection)]="selectedNodes"
      (selectionChange)="onSelectionChange($event)"
      (onNodeSelect)="onNodeSelect($event)"
      (onNodeUnselect)="onNodeUnselect($event)"
      (onNodeExpand)="onNodeExpand($event)"
      (onNodeCollapse)="onNodeCollapse($event)">
    </p-tree>
    
    <!-- Empty State -->
    <div *ngIf="!processedTreeData || processedTreeData.length === 0" 
         class="text-center py-8 text-gray-500">
      <div class="text-4xl mb-2">📭</div>
      <p class="text-lg font-medium">No data available</p>
      <p class="text-sm">Add some tree data to get started</p>
    </div>
  </div>

  <!-- Footer Summary (when items are selected) -->
  <div *ngIf="counts.selectedNodes > 0" 
       class="tree-footer mt-4 p-3 bg-green-50 border border-green-200 rounded-lg">
    <div class="flex items-center justify-between">
      <div class="flex items-center space-x-3">
        <span class="text-green-600 text-lg">✅</span>
        <div>
          <span class="text-sm font-medium text-green-800">
            {{ counts.selectedNodes }} {{ counts.selectedNodes === 1 ? 'item' : 'items' }} selected
          </span>
          <div class="text-xs text-green-600">
            Ready for processing or action
          </div>
        </div>
      </div>
      <div class="text-xs text-green-600">
        {{ ((counts.selectedNodes / counts.totalNodes) * 100) | number:'1.1-1' }}% complete
      </div>
    </div>
  </div>
</div>