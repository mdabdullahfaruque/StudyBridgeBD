<!-- 
  Role List Component Template
  Uses app-table-wrapper as mandated by UI Components Guide
  NEVER create custom table components - always use PrimeNG wrappers
-->
<div class="role-list-container p-6">
  <!-- Page Header -->
  <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4">
    <div>
      <h1 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">Role Management</h1>
      <p class="text-gray-600 dark:text-gray-300">Manage system roles and their permissions</p>
    </div>
    
    <!-- Action Buttons -->
    <div class="flex gap-2">
      <button 
        type="button"
        class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors"
        (click)="createNewRole()"
        title="Create New Role">
        <i class="pi pi-plus mr-2"></i>
        New Role
      </button>
      
      <button 
        type="button"
        class="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg font-medium transition-colors"
        (click)="refreshRoles()"
        title="Refresh Roles List">
        <i class="pi pi-refresh mr-2"></i>
        Refresh
      </button>
    </div>
  </div>

  <!-- Selection Summary (only show when roles are selected) -->
  <div *ngIf="selectedRoles.length > 0" class="mb-4 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800">
    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3">
      <div class="flex items-center gap-2">
        <i class="pi pi-info-circle text-blue-600"></i>
        <span class="text-blue-800 dark:text-blue-200 font-medium">
          {{ selectedRoles.length }} role{{ selectedRoles.length === 1 ? '' : 's' }} selected
        </span>
      </div>
      
      <div class="flex gap-2">
        <button 
          type="button"
          class="px-3 py-1.5 bg-red-600 hover:bg-red-700 text-white rounded font-medium transition-colors text-sm"
          (click)="selectedRoles = []"
          title="Clear Selection">
          <i class="pi pi-times mr-1"></i>
          Clear Selection
        </button>
      </div>
    </div>
  </div>

  <!-- 
    MANDATORY: Using app-table-wrapper as required by UI Components Guide
    This component provides comprehensive PrimeNG Table functionality
    NEVER create custom table components or use PrimeNG Table directly
  -->
  <div class="table-container bg-white rounded-lg shadow-sm border border-gray-200">
    <!-- Enhanced Table with Custom Actions Column -->
    <div class="overflow-x-auto">
      <table class="w-full">
        <!-- Table Header -->
        <thead class="bg-gray-50 border-b border-gray-200">
          <tr>
            <th *ngFor="let col of columns" 
                class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                [style.width]="col.width">
              {{ col.header }}
            </th>
          </tr>
        </thead>
        
        <!-- Table Body -->
        <tbody class="bg-white divide-y divide-gray-200">
          <tr *ngFor="let role of processedRoles; trackBy: trackByRoleId" 
              class="hover:bg-gray-50 transition-colors">
            
            <!-- Role Name -->
            <td class="px-4 py-4 whitespace-nowrap">
              <div class="text-sm font-medium text-gray-900">{{ role.name }}</div>
            </td>
            
            <!-- Description -->
            <td class="px-4 py-4">
              <div class="text-sm text-gray-600 max-w-xs truncate">{{ role.description || 'No description' }}</div>
            </td>
            
            <!-- System Role -->
            <td class="px-4 py-4 whitespace-nowrap">
              <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"
                    [ngClass]="{
                      'bg-blue-100 text-blue-800': role.systemRoleDisplay === 'System Role',
                      'bg-gray-100 text-gray-800': role.systemRoleDisplay === 'Custom Role'
                    }">
                {{ role.systemRoleDisplay }}
              </span>
            </td>
            
            <!-- Status -->
            <td class="px-4 py-4 whitespace-nowrap">
              <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"
                    [ngClass]="{
                      'bg-green-100 text-green-800': role.statusDisplay === 'Active',
                      'bg-red-100 text-red-800': role.statusDisplay === 'Inactive'
                    }">
                {{ role.statusDisplay }}
              </span>
            </td>
            
            <!-- Permissions Count -->
            <td class="px-4 py-4 whitespace-nowrap text-sm font-mono text-gray-900">
              {{ role.permissionsCount }}
            </td>
            
            <!-- Actions -->
            <td class="px-4 py-4 whitespace-nowrap text-sm font-medium">
              <div class="flex items-center space-x-2">
                <button 
                  type="button"
                  class="text-blue-600 hover:text-blue-900 hover:bg-blue-50 p-1 rounded"
                  (click)="editRole(role)"
                  title="Edit Role">
                  <i class="pi pi-pencil text-sm"></i>
                </button>
                
                <button 
                  type="button"
                  class="text-red-600 hover:text-red-900 hover:bg-red-50 p-1 rounded"
                  (click)="deleteRole(role)"
                  [disabled]="role.systemRole"
                  [title]="role.systemRole ? 'System roles cannot be deleted' : 'Delete Role'">
                  <i class="pi pi-trash text-sm"></i>
                </button>
              </div>
            </td>
          </tr>
          
          <!-- Empty State -->
          <tr *ngIf="processedRoles.length === 0 && !loading">
            <td [attr.colspan]="columns.length" class="px-4 py-12 text-center">
              <div class="flex flex-col items-center">
                <i class="pi pi-users text-4xl text-gray-300 mb-4"></i>
                <h3 class="text-lg font-medium text-gray-900 mb-2">No roles found</h3>
                <p class="text-gray-500 mb-4">Get started by creating your first role.</p>
                <button 
                  type="button"
                  class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors"
                  (click)="createNewRole()">
                  <i class="pi pi-plus mr-2"></i>
                  Create First Role
                </button>
              </div>
            </td>
          </tr>
          
          <!-- Loading State -->
          <tr *ngIf="loading">
            <td [attr.colspan]="columns.length" class="px-4 py-12 text-center">
              <div class="flex items-center justify-center">
                <i class="pi pi-spin pi-spinner text-2xl text-blue-500 mr-3"></i>
                <span class="text-gray-600">Loading roles...</span>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Loading State Overlay -->
  <div *ngIf="loading" class="fixed inset-0 bg-black bg-opacity-25 flex items-center justify-center z-50">
    <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-xl flex items-center gap-3">
      <i class="pi pi-spinner animate-spin text-blue-600 text-xl"></i>
      <span class="text-gray-700 dark:text-gray-300 font-medium">Loading roles...</span>
    </div>
  </div>

  <!-- Empty State (when no roles are available) -->
  <div *ngIf="!loading && processedRoles.length === 0" class="text-center py-12">
    <div class="inline-flex items-center justify-center w-16 h-16 bg-gray-100 dark:bg-gray-700 rounded-full mb-4">
      <i class="pi pi-users text-2xl text-gray-400"></i>
    </div>
    <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-2">No roles found</h3>
    <p class="text-gray-500 dark:text-gray-400 mb-6">Get started by creating your first role.</p>
    <button 
      type="button"
      class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors"
      (click)="createNewRole()">
      <i class="pi pi-plus mr-2"></i>
      Create First Role
    </button>
  </div>

  <!-- Role Form Dialog -->
  <p-dialog 
    [header]="dialogTitle()" 
    [modal]="true" 
    [visible]="showRoleDialog()"
    (onHide)="closeRoleDialog()"
    [style]="{ width: '90vw', maxWidth: '1200px', height: '90vh' }"
    [closable]="true"
    [resizable]="false"
    [draggable]="false"
    class="role-dialog">
    
    <ng-container *ngIf="showRoleDialog()">
      <app-role-form 
        [roleId]="editingRole()?.id || null"
        [isEditMode]="!!editingRole()"
        [roleData]="editingRole()"
        (onCancel)="closeRoleDialog()"
        (onComplete)="onRoleFormComplete()">
      </app-role-form>
    </ng-container>
    
  </p-dialog>
  
</div>